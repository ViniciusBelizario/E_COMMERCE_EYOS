<h2>Cadastro de Categorias</h2>

<!-- Formulário para cadastrar nova categoria -->
<form id="categoriaForm">
    <label for="nome">Nome da Categoria:</label>
    <input type="text" id="nome" name="nome" required>
    <button type="submit">Cadastrar</button>
</form>

<!-- Tabela para exibir categorias cadastradas -->
<div class="table-container">
    <h3>Categorias Cadastradas</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="categoriaList">
            <!-- Categorias serão carregadas via JavaScript -->
        </tbody>
    </table>
</div>

<script>
async function carregarCategorias() {
    const token = localStorage.getItem("token");
    if (!token) {
        alert("Usuário não autenticado! Faça login novamente.");
        window.location.href = "/auth/login";
        return;
    }

    const response = await fetch("http://localhost:3001/categorias/api", {
        method: "GET",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        }
    });

    if (response.status === 401) {
        alert("Sessão expirada. Faça login novamente.");
        window.location.href = "/auth/login";
        return;
    }

    const categorias = await response.json();
    const tabela = document.getElementById("categoriaList");
    tabela.innerHTML = "";

    categorias.forEach(categoria => {
        const row = `
            <tr>
                <td>${categoria.id}</td>
                <td>${categoria.nome}</td>
                <td>
                    <button class="delete-btn" onclick="deletarCategoria(${categoria.id})">Excluir</button>
                </td>
            </tr>
        `;
        tabela.innerHTML += row;
    });
}

async function deletarCategoria(id) {
    const token = localStorage.getItem("token");
    await fetch(`http://localhost:3001/categorias/api/${id}`, {
        method: "DELETE",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        }
    });
    carregarCategorias();
}

document.getElementById("categoriaForm").addEventListener("submit", async (event) => {
    event.preventDefault();
    const nome = document.getElementById("nome").value;
    const token = localStorage.getItem("token");

    await fetch("http://localhost:3001/categorias/api", {
        method: "POST",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ nome })
    });
    carregarCategorias();
});

carregarCategorias();
</script>
