<main>
  <h2>Gerenciar Categorias</h2>

  <form id="categoriaForm">
    <label for="nome">Nome da Categoria:</label>
    <input type="text" id="nome" required>
    <button type="submit">Cadastrar</button>
  </form>

  <div class="table-container">
    <h3>Categorias Cadastradas</h3>
    <table>
      <thead>
        <tr><th>ID</th><th>Nome</th><th>Ações</th></tr>
      </thead>
      <tbody id="categoriaList"></tbody>
    </table>
  </div>
</main>

<script type="module">
  import { apiJson } from "/js/api.js";

  async function carregarCategorias() {
    const categorias = await apiJson("/categorias");
    const tbody = document.getElementById("categoriaList");
    tbody.innerHTML = "";
    categorias.forEach(c => {
      tbody.innerHTML += `
        <tr>
          <td>${c.id}</td>
          <td>${c.nome}</td>
          <td><button class="delete-btn" onclick="deletarCategoria(${c.id})">Excluir</button></td>
        </tr>`;
    });
  }

  window.deletarCategoria = async (id) => {
    await apiJson(`/categorias/${id}`, { method: "DELETE" });
    carregarCategorias();
  };

  document.getElementById("categoriaForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nome = document.getElementById("nome").value.trim();
    if (!nome) return alert("Informe o nome.");
    await apiJson("/categorias", { method: "POST", body: { nome } });
    (document.getElementById("nome").value = "");
    carregarCategorias();
  });

  carregarCategorias();
</script>
